# í¬íŒ… ë§¤ë‰´ì–¼

ë§ˆê°ì¼: 2023ë…„ 11ì›” 17ì¼
<br>
ë‹´ë‹¹ì: ë°•ì„¸ìœ¤

<br>

## 1. Version

### Backend 

```json
"Java"             : "OpenJDK 11.0.1"
"Spring"           : "5.3.22"
"Spring Boot"      : "2.7.16"
"Spring Security"  : "2.7.16"
"Spring-Data-JPA"  : "2.7.16"
"JWT"              : "0.9.1"
"Gradle"           : "8.3"
"Gson"             : "2.9.0"
"OpenAI"           : "1.0.4"
"OpenAI Model"     : "Turbo 3.5 - 16K"
"WebClient"        : "2.7.16"
"TTS"              : "2.28.0"
"AOP"              : "2.7.16"
"Commons-Codec" : "1.15"
"Spring-Boot-Starter" : "1.0.4"
"Lombok" : "1.18.30"
```

### Frontend

```json
"React"                   : "^18.2.0"
"Recoil"                  : "^0.7.7"
"TypeScript"              : "^5.0.2"
"npm"                     : "9.8.1"
"node.js"                 : "^20.8.9"
"Axios"                   : "^1.5.1"
"vite"                    : "^4.4.5"
"tailwindcss"             : "^3.3.3"
"three"                   : "^0.157.0"
"@react-three/cannon"     : "^6.6.0",
"@react-three/drei"       : "^9.88.5",
"@react-three/fiber"      : "^8.15.5",
"axios"                   : "^1.5.1",
"leva"                    : "^0.9.35",
"lottie-react"            : "^2.4.0",
"react-speech-recognition": "^3.10.0",
```

### Database & Storage

```json
"AWS RDS(MySQL)" : "8.0.33"
"AWS S3" : "2.2.6.RELEASE"
```

### Infra

```json
"Ubuntu"        : "20.0.4 LTS"
"Jenkins"       : "2.414.1"
"Docker"        : "24.0.6"
"Nginx"         : "1.18.0 (Ubuntu)"
"SonarQube"     : "4.2.1.3168"
"Jacoco"        : "0.8.8"
"Prometheus"    : "1.9.15"
"Grafana"       : "10.1.5"
```

## 2. Port

| Port | ìš©ë„ | ê°œë°© |
| --- | --- | --- |
| 22 | SSH | â­• |
| 80 | NGINX | â­• |
| 443 | NGINX | â­• |
| 8888 | Jenkins | â­• |
| 9999 | Grafana | â­• |
| 7777 | SonarQube | â­• |  
| 8081, 8082, 8180, 8181 | BE PJT | âŒ |
| 3000, 3001 | FE PJT | âŒ |
| 9998, 9997 | Prometheus, Node-Exporter | âŒ |

## 3. Setting File

- **application.yml**

    ```yaml
    # SpringBoot Port Setting
    server:
      port: []
    
    # YML Connection
    spring:
    
      # Multi-YML Setting
      config:
        import: classpath:application-db.yml
      
      mvc:
        # MVC Default Path Setting
        static-path-pattern: /static/**
      
          # MVC Path Matching Strategy Setting
          pathmatch:
            matching-strategy: ant_path_matcher
      
      
    # SOCIAL LOGIN
    social-login:
      kakao:
        secret: []
        client: []
        auth-uri: []
        user-info-uri: []
      google:
        secret: []
        client: []
        auth-uri: []
        user-info-uri: []
      
      
    # JWT SECRET
    jwt:
      secret: []
    
    # OPEN AI
    OPEN_AI:
      URL: []
      KEY: []
    
    #SPEECH_SUPER
    SPEECH_SUPER:
      URL: []
      APP_KEY: []
      SECRET_KEY: []
    
    # PAPAGO API
    PAPAGO:
      CLIENT: []
      SECRET: []
      URL: []
    
    logging:
      level:
        root: INFO
        com.lingotown.global.util: DEBUG
      pattern:
        console: []
    
    s3url: []
    ```

  - **application-db.yml**

      ```yaml
      spring:
        # MySQL
        datasource:
          url: jdbc:mysql://[]:[]/[]
          username: []
          password: []
          driver-class-name: com.mysql.cj.jdbc.Driver
      
        # JPA
        jpa:
          open-in-view: false
          show-sql: true
          hibernate:
            ddl-auto: update
          properties:
            hibernate:
              format_sql: true
      
        # S3
        cloud:
          aws:
            s3:
              bucket: []
            credentials:
              access-key: []
              secret-key: []
        
            # AWS Region
            region:
              static: ap-northeast-2
              auto: false
        
            # AWS Stack
            stack:
              auto: false
      ```

  - **.env**
    ```agsl
    VITE_SERVER=[]

    # ë°°í¬ ì„¸íŒ…
    VITE_GOOGLE_LOGIN=[]
    VITE_KAKAO_LOGIN=[]
    
    VITE_GOOGLE_CALLBACK=[]
    VITE_KAKAO_CALLBACK=[]
    
    # S3 ì£¼ì†Œ
    VITE_S3_URL=[]
    ```
  
  - **sonar-project.properties**
    ```properties
    sonar.projectKey=[]
    ```
<aside>

ğŸš¨ ê°ì¢… ì„¤ì •íŒŒì¼ì€ ```ê³¼ê¸ˆ```ì´ ë  ìˆ˜ ìˆëŠ” ë¯¼ê°ì •ë³´ë“¤ì´ ì¡´ì¬í•˜ë¯€ë¡œ, ```Jenkins``` ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— í™˜ê²½ì— ë³„ë„ë¡œ ì‘ì„±

</aside>

<br><br>

## 4 EC2 ì‚¬ì „ ì„¤ì •

```bash
# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
$ sudo apt-get update

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common
# Docker GPG í‚¤ ì¶”ê°€
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
# Docker apt repository ì¶”ê°€
$ sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
$ sudo apt-get update
# Docker ì„¤ì¹˜
$ sudo apt-get install docker-ce docker-ce-cli containerd.io

# ê¶Œí•œ ì„¤ì •
cd /var/run
sudo chmod 777 docker.sock
```

**ë°©í™”ë²½**
```bash
# ë°©í™”ë²½ ì„¤ì •
sudo ufw status # Status : inactive

# ufw í™œì„±í™”
sudo ufw enable

# ì‚¬ìš©í•  í¬íŠ¸ í—ˆìš©
sudo ufw allow [í¬íŠ¸ë²ˆí˜¸] 

# ufw ìƒíƒœ ë° ë“±ë¡ëœ rule í™•ì¸
sudo ufw status numbered

# ë“±ë¡í•œ í¬íŠ¸ ì‚­ì œ
sudo ufw delete [ë²ˆí˜¸]
```

**Nginx**

```bash
# Nginx ì„¤ì¹˜
$ sudo apt-get install nginx

# SSL ì¸ì¦ì„ ìœ„í•œ Certbot, LetsEncrypt
$ sudo apt-get install certbot python3-certbot-nginx
$ sudo apt-get install letsencrtypt

# Certbotì„ í†µí•œ SSL ì¸ì¦ì„œ ë°œê¸‰ (ì´ë©”ì¼, ë„ë©”ì¸ í•„ìš”)
$ sudo certbot --nginx
```

```bash
# Nginx ì„¤ì •íŒŒì¼
# /etc/nginx/conf.d/default.conf

limit_req_zone $binary_remote_addr:$uri zone=request_limit_per_ip:10m rate=3r/s;

server {
        server_name lingotown.shop;

        location / {
                proxy_pass http://localhost:3001;
								add_header 'Access-Control-Allow-Origin' '*';
        }

        location /api {
                proxy_pass http://localhost:8081;
                proxy_set_header Connection '';
                proxy_http_version 1.1;
                proxy_read_timeout 86400;
                limit_req zone=request_limit_per_ip burst=5 delay=10;
                limit_req_status 429;
        }

        location /ws {
                proxy_pass http://localhost:8081;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection "Upgrade";
                proxy_set_header Host $host;
        }

    listen [::]:443 ssl http2 ipv6only=on;
    listen 443 ssl http2; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/lingotown.shop/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/lingotown.shop/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
}

server {
    if ($host = lingotown.shop) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    server_name lingotown.shop;
    listen 80;
    return 404; # managed by Certbot
}
```

```bash
# Front Root Directoryì— ë³´ìœ í•˜ëŠ” Nginx íŒŒì¼

http {
    include       /etc/nginx/mime.types;
    default_type  text/html;

    server {
        listen 3000;

        server_name localhost;

        location / {
            index index.html;
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
        }   
    }
    
}

events {
    worker_connections 1024;
}
```

```bash
# í…ŒìŠ¤íŠ¸
sudo nginx -t

sudo systemctl status nginx.service
```

```bash
# ë§Œì•½ í…ŒìŠ¤íŠ¸ ê²°ê³¼, listen ë“±ì´ ì¤‘ë³µëœë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´ ...

# ì‹¬ë³¼ë¦­ ë§í¬ ì œê±°
sudo rm /etc/nginx/sites-enabled/default

# í…ŒìŠ¤íŠ¸
sudo nginx -t

# ì¬ì‹œì‘
sudo systemctl restart nginx 
```

### Jenkins

```bash
# Jenkins ì´ë¯¸ì§€ PULL
$ sudo docker pull jenkins/jenkins:lts

# Jenkins ì»¨í…Œì´ë„ˆ ì‹¤í–‰
# -d : ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
# -p : 
# --user root : ê´€ë¦¬ì ê¶Œí•œ ì‹¤í–‰

# ë§Œì•½ í™˜ê²½ë³€ìˆ˜ë¥¼ ê°™ì´ ë„˜ê²¨ì¤˜ì•¼ í•  ì¼ì´ ìˆë‹¤ë©´ ì•„ë˜ í™˜ê²½ë³€ìˆ˜ ê´€ë ¨ ì •ë¦¬ íƒ­ì˜ ëª…ë ¹ì–´ë¥¼ í™œìš©í•  ê²ƒ,

$ sudo docker run -d -u root -it -v /var/run/docker.sock:/var/run/docker.sock -v /lib/modules:/lib/modules -p 8888:8080 --name jenkins jenkins/jenkins:lts
```

```bash
# 1. Jenkins ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it jenkins /bin/bash

# 2. Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜(docker cli, vim) ë° ì‚¬ìš©ì ê¶Œí•œ ë¶€ì—¬
# Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ docker clië¥¼ ì„¤ì¹˜í•œë‹¤ê³  dind ë°©ì‹ì¸ ê²ƒì€ ì•„ë‹ˆë‹¤.
# socket í†µì‹ ì„ ìœ„í•´ clië¥¼ í™œìš©í•  ë¿, docker daemonì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— 
# ì—¬ì „íˆ dood ë°©ì‹ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

apt-get update

apt-get install docker-cli

# ë§Œì•½ ìœ„ ëª…ë ¹ì–´ì—ì„œ docker-cli íŒ¨í‚¤ì§€ë¥¼ ëª»ì°¾ëŠ” ì—ëŸ¬ê°€ ë‚˜ì˜¨ë‹¤ë©´ .....
# ì´ ì  í‚¨ìŠ¤ ì´ë¯¸ì§€ê°€ ubuntuê°€ ì•„ë‹Œ debian ê¸°ë°˜ ì´ë¯¸ì§€ì¸ë°, 
# debian ê¸°ë°˜ì—ì„œ Dockerì™€ ê´€ë ¨ëœ íŒ¨í‚¤ì§€ì— docker-clië¼ëŠ” ì´ë¦„ì´ ì—†ëŠ” ê²ƒì´ë‹¤.
# ë”°ë¼ì„œ ì•„ë˜ ì„¤ì •ì„ ë”°ë¥¸ë‹¤. 

# ì €ì¥ì†Œ ì •ë³´ ì…ë ¥
# echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian bookworm stable" | tee /etc/apt/sources.list.d/docker.list

# ì €ì¥ì†Œ GPG í‚¤ ë‹¤ìš´ ë° ì‹ ë¢° ëª©ë¡ì— ì¶”ê°€
# curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# ì•„ë˜ ì—…ë°ì´íŠ¸ê°€ ì ìš©ë˜ë©´ Docker ì €ì¥ì†Œê°€ ì‹œìŠ¤í…œì— ì˜¬ë°”ë¥´ê²Œ ì¶”ê°€ ëœ ê²ƒ
# apt-get update

# apt-get install -y docker-ce-cli

# docker ps -aë¡œ ì™¸ë¶€ì—ì„œ ì‹¤í–‰í•œ jenkins ì»¨í…Œì´ë„ˆê°€ jenkins ë‚´ë¶€ì—ì„œë„ ì‹¤í–‰ì¤‘ì¸ì§€ í™•ì¸

apt-get install vim

# 3. ì„¤ì • íŒŒì¼ ì„¸íŒ… (ì„¤ì •íŒŒì¼ì˜ ìœ„ì¹˜ëŠ” Jenkinsfileì—ì„œì˜ ì„¸íŒ…ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.)
cd usr
# ë§Œì•½ ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
cd react
# í”„ë¡ íŠ¸ ì„¤ì •íŒŒì¼(.env ë“±) ë³µë¶™í•˜ì„¸ìš”
vim .env 

cd ..
cd spring
cd resources
# ë°± ì„¤ì •íŒŒì¼(ymlì´ë‚˜ properties) ë³µë¶™í•˜ì„¸ìš”
vim application.yml

cd ..
cd fastapi
# AI(FastAPI) ì„¤ì •íŒŒì¼ë³µë¶™í•˜ì„¸ìš”
vim config.py

# 4. Jenkins ë¹„ë°€ë²ˆí˜¸ í™•ì¸
cat /var/jenkins_home/secrets/initialAdminPassword

# 5. ì›¹ í˜ì´ì§€ì—ì„œ Jenkins ì ‘ì†
ID : admin
PWD : 2ë²ˆì—ì„œ ì–»ì€ ê°’
```

### 4. ë°°í¬

**BackEnd Spring**
```docker
# ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¡œ ë°˜ë“œì‹œ ìµœìƒë‹¨ì— ìœ„ì¹˜í•´ì•¼ í•œë‹¤.
FROM openjdk:11-jdk

# ë³´ì•ˆì„ ìœ„í•´ ì„¤ì •íŒŒì¼ì„ ë³µì‚¬í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ, ì  í‚¨ìŠ¤ì—ì„œ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— ì£¼ì„ ì²˜ë¦¬
# COPY usr/spring/resources ./resources

# ì  í‚¨ìŠ¤ê°€ ë¹Œë“œí•œ ë°±ì—”ë“œ í”„ë¡œì íŠ¸ Jar íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì—ì„œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ë³µì‚¬í•œë‹¤.
COPY build/libs/*.jar application.jar

# ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì„¤ì •í•œë‹¤.
EXPOSE 8081

# ì´ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë  ê²½ìš° ìˆ˜í–‰í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •í•œë‹¤.
ENTRYPOINT ["java","-jar", "-Duser.timezone=Asia/Seoul", "application.jar"]
```

```go
// BE Jenkinsfile
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.16'
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'

    /* 2023.10.25 : Sonarqube */
    id 'org.sonarqube' version '4.2.1.3168'

    /* 2023.11.08 : Jacoco */
    id 'jacoco'
}

group = 'LingoTown'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '11'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    compileOnly 'org.projectlombok:lombok'
    developmentOnly 'org.springframework.boot:spring-boot-devtools'
    runtimeOnly 'com.mysql:mysql-connector-j'
    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    /* 2023.10.17 */
    implementation 'org.springframework.boot:spring-boot-starter-security'

    // gson
    implementation 'com.google.code.gson:gson:2.9.0'

    // JWT
    implementation 'io.jsonwebtoken:jjwt:0.9.1'

    //S3
    implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'

    //gpt
    implementation 'io.github.flashvayne:chatgpt-spring-boot-starter:1.0.4'

    /* 2023.10.24 : ë°°í¬ ëª¨ë‹ˆí„°ë§ */
    implementation 'io.micrometer:micrometer-registry-prometheus'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'

    /* 23.10.26 WebClient ìœ„í•œ WebFlux ì˜ì¡´ì„± ì¶”ê°€ */
    implementation 'org.springframework.boot:spring-boot-starter-webflux'

    /* AOP : ì‹¤í–‰ì‹œê°„ ì¸¡ì • ìš© */
    implementation 'org.springframework.boot:spring-boot-starter-aop'

    /* 2023.10.30 : TTS */
    implementation 'com.google.cloud:google-cloud-texttospeech:2.28.0'

    /* 2023.10.30 : Multipart ë³€í™˜ê¸° */
    implementation 'org.springframework:spring-test:5.3.30'

    /* 2023.11.09 : Apache HttpClient ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ */
    implementation 'org.apache.httpcomponents:httpmime:4.5.13'

    /* 2023.11.09 : Apache Commons Codec ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ */
    implementation 'commons-codec:commons-codec:1.15'

}

tasks.named('test') {
    useJUnitPlatform()
    finalizedBy 'jacocoTestReport' 
}

/* 2023.10.25 : Sonarqube */
sonar {
    properties {
        property "sonar.projectKey", "s09-final_S09P31B305_AYtkLpUWXphQim437K7_"
        property "sonar.projectName", "S09P31B305"
        property 'sonar.test.inclusions', '**/*Test.java'
        property 'sonar.exclusions', '**/test/**, **/Q*.java, **/*Doc*.java, **/resources/**'

        // Jacocoì˜ Coverage íŒŒì¼ ë¶„ì„
        property 'sonar.coverage.jacoco.xmlReportPaths', '${buildDir}/reports/jacoco/test/jacocoTestReport.xml'
    }
}

/* 2023.11.08 : Jacoco */
jacoco {
    toolVersion = '0.8.8'
}

jacocoTestReport {
    // í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë°›ì„ íŒŒì¼ í˜•ì‹
    reports {
        html.required.set(true)
        xml.required.set(true)
        csv.required.set(false)
    }
}
```

<br>

**Frontend**

```docker
FROM node:18-alpine AS build

# ENV NODE_ENV=production

WORKDIR /Front

COPY package.json .

RUN npm cache clean --force

# Typescript ë¨¼ì € install
RUN npm install -g typescript vite

RUN npm install @vitejs/plugin-react-swc

# ENV NODE_ENV=development

RUN npm install

ENV NODE_ENV=production

COPY . .

RUN vite build

# RUN npm run build

FROM nginx:1.21.3-alpine

COPY nginx.conf /etc/nginx/nginx.conf

COPY --from=build /Front/dist /usr/share/nginx/html

EXPOSE 3001

CMD [ "nginx", "-g", "daemon off;" ]
```

```go
// Frontend Jenkinsfile
pipeline {
    agent any

    tools {
        nodejs "LingoTownNodeJS"
    }

    stages {
        stage("Set Variable") {
            steps {
                script {
                    IMAGE_NAME_FE = "lingotown_front_image"
                    CONTAINER_NAME_FE = "LingoTown_Front_Prod"
                    APPLICATION_ENV_PATH = "/usr/react"
                    PROJECT_DIR_FE = "Front"
                }
            }
        }

        // ì„¤ì •íŒŒì¼ ì°¸ì¡°
        stage("Copy Setting File") {
            steps {
                sh "cp ${APPLICATION_ENV_PATH}/.env ${PROJECT_DIR_FE}"
                sh "cp ${APPLICATION_ENV_PATH}/sonar-project.properties ${PROJECT_DIR_FE}"
            }
        }

        // SonarQube ë¶„ì„
        stage('SonarQube Analysis') {  
            steps {
                script {
                    def scannerHome = tool 'SonarQubeScanner'

                    withSonarQubeEnv('SonarQube') {
                        dir("${PROJECT_DIR_FE}") {
                            sh "${scannerHome}/bin/sonar-scanner"
                        }
                    }
                }
            }
        }


        // ì»¨í…Œì´ë„ˆ í´ë¦¬ë‹
        stage("Docker Container Cleaning") {
            steps{
                sh "docker ps -q -f name=${CONTAINER_NAME_FE} | xargs --no-run-if-empty docker container stop"    
                sh "docker container ls -a -q -f name=${CONTAINER_NAME_FE} | xargs --no-run-if-empty docker rm"
            }
        }

        // ì´ë¯¸ì§€ í´ë¦¬ë‹
        stage("Docker Image Cleaning") {
            steps{
                script {
                    // latest íƒœê·¸ì˜ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•œë‹¤. 
                    // latest-success íƒœê·¸ì˜ ì´ë¯¸ì§€ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤
                    // ì´í›„ ìƒˆ ì´ë¯¸ì§€ ì„±ê³µ / ì‹¤íŒ¨ì— ë”°ë¼ ê¸°ì¡´ latest-success ì´ë¯¸ì§€ì˜ ì‚­ì œ ì—¬ë¶€ë¥¼ ë‹¤ë¥´ê²Œ í•˜ê¸° ìœ„í•´
                    sh "docker rmi -f ${IMAGE_NAME_FE}:latest | true"
                }
            }
        }
        
        // ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ
        stage("Docker Image Build") {
            steps {
                dir("${PROJECT_DIR_FE}") {
                    script {
                        // í˜„ì¬ ì´ë¯¸ì§€ ë¹Œë“œ
                        sh "docker build --no-cache -t ${IMAGE_NAME_FE}:latest ."

                        // ë¹Œë“œ ì„±ê³µ ì‹œ ê¸°ì¡´ latest-success íƒœê·¸ ì‚­ì œ
                        sh "docker rmi ${IMAGE_NAME_FE}:latest-success || true"

                        // ë¹Œë“œ ì„±ê³µ ì‹œ, ì´ë¯¸ì§€ì— latest-success íƒœê·¸ ì¶”ê°€
                        sh "docker tag ${IMAGE_NAME_FE}:latest ${IMAGE_NAME_FE}:latest-success"

                        // ë§Œì•½ ë¹Œë“œ ì‹¤íŒ¨ ì‹œ, ê¸°ì¡´ latest-success íƒœê·¸ëŠ” ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤.
                    }
                }
            }
        }

        // ì»¨í…Œì´ë„ˆ ì‹¤í–‰
        stage("Docker Container Run") {
            steps {
                script {
                    // ì´ì „ ìŠ¤í…Œì´ì§€ì—ì„œ ë¹Œë“œ ì„±ê³µ í–ˆì„ ë•Œë¡œ ìƒˆë¡œ ë“±ë¡í•œ latest-success íƒœê·¸ì˜ ì´ë¯¸ì§€ ì‚¬ìš©
                    sh "docker run -d -p 3001:3000 --name ${CONTAINER_NAME_FE} ${IMAGE_NAME_FE}:latest-success"
                }
            }
        }
    }

    post {
        failure {
            script {
                // í˜„ì¬ ì‹¤í–‰ ì¤‘ì´ê±°ë‚˜ ë©ˆì¶°ìˆëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì •ì§€í•˜ê³  ì œê±°í•©ë‹ˆë‹¤.
                sh "docker ps -a -q -f name=${CONTAINER_NAME_FE} | xargs --no-run-if-empty docker stop"
                sh "docker ps -a -q -f name=${CONTAINER_NAME_FE} | xargs --no-run-if-empty docker rm"

                // 'latest-success' ì´ë¯¸ì§€ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
                LATEST_SUCCESS_IMAGE_ID = sh(script: "docker images ${IMAGE_NAME_FE}:latest-success -q", returnStdout: true).trim()
                
                // RollBack ì„±ê³µ - ì´ì „ì— ì„±ê³µí•œ ì´ë¯¸ì§€ë¡œ ìƒˆ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•˜ì§€ë§Œ, ì»¨í…Œì´ë„ˆ ì´ë¦„ì€ ë™ì¼í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.
                if (LATEST_SUCCESS_IMAGE_ID) 
                    sh "docker run -d -p 3001:3000 --name ${CONTAINER_NAME_FE} ${IMAGE_NAME_FE}:latest-success"

                // RollBack ì‹¤íŒ¨
                else 
                    echo "RollBack Fail. No available image for rollback. Please check the previous successful build and its image."
            }
        }
    }
}
```

### 5. ì™¸ë¶€ API

**KAKAO Login**

[Kakao Developers](https://developers.kakao.com/product/kakaoLogin)

**Google Login**

[ì›¹ ì•±ì— Google ë¡œê·¸ì¸ í†µí•©     Â |Â  Authentication Â |Â  Google for Developers](https://developers.google.com/identity/sign-in/web/sign-in?hl=ko)

** Google TTS API **

** Google STT API **

** Papago API **

** Open AI API **